name: CI/CD 
on:
 push:
   branches: ['master']
   
 workflow_dispatch:
 defaults:
    run:
      working_directory: ./
    jobs:
      build:
        name: build
        runs-on: ubuntu-latest

    steps:
     - name: Cloning the project repo
       uses: actions/checkout@v3

     - name: Install nodejs
       uses: actions/setup-node
       with: 
          node-version: 14.x

     - name: Install dependencies
     - run: npm install

     - name: Build
       run: npm run build

     - name: Upload our production ready build files
     - uses: actions/upload-artifact@v3
       with:
          name: production
          path: ./build
    deploy:
        runs-on: ubuntu-latest
        needs: [build]
        environment:
          name: production
        steps:
          - name: downloading artifacts
            uses: actions/download-artifact@v3
          - name: Deploying to gh-page
            uses: crazy-max/ghaction-github-pages@v3
            with:
              target_branch: gh-pages
              build_dir: ./build
      steps:
        - uses: actions/stale@v6
          with:
            stale-issue-message: 'This issue is stale because it has been open 30 days with no activity. Remove stale label or comment or this will be closed in 5 days.'
            stale-pr-message: 'This PR is stale because it has been open 45 days with no activity. Remove stale label or comment or this will be closed in 10 days.'
            close-issue-message: 'This issue was closed because it has been stalled for 5 days with no activity.'
            days-before-stale: 30
            days-before-close: 5
            days-before-pr-close: -1 
